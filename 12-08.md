# Домашнее задание к занятию «Резервное копирование баз данных»

**Домашнее задание выполните в Google Docs или в md-файле в вашем репозитории GitHub.** 

Для оформления вашего решения в GitHub можете воспользоваться [шаблоном](https://github.com/netology-code/sys-pattern-homework).

Название файла должно содержать номер лекции и фамилию студента. Пример названия: «12.8. Резервное копирование баз данных — Александр Александров».

Перед тем как выслать ссылку, убедитесь, что её содержимое не является приватным, то есть открыто на просмотр всем, у кого есть ссылка. Если необходимо прикрепить дополнительные ссылки, просто добавьте их в свой Google Docs.

Любые вопросы по решению задач задавайте в чате учебной группы.

---

### Задание 1. Резервное копирование

### Кейс
Финансовая компания решила увеличить надёжность работы баз данных и их резервного копирования. 

Необходимо описать, какие варианты резервного копирования подходят в случаях: 

1.1. Необходимо восстанавливать данные в полном объёме за предыдущий день.
 Для восстановления даннsx за предыдущий день  подойдет несколько вариантов в зависисмости от инфраструктуры, наличи дисквого пространста, наличии  технологическог времени, размера БД: 
- ежедневный полный бэкап в технологическое время(например ночью в 03.00);
- еженедельный полный бэкап(например в субботу в 01.00)  + дифференциальный бэкап (восресенье-пятница в 01.00) 

1.2. Необходимо восстанавливать данные за час до предполагаемой поломки.
- подойдет еженедельный полный бэкап(например в субботу в 01.00)  + дифференциальный бэкап (восресенье-пятница в 01.00) + инкрементные бэкапы каждый час (2.00-00.00) 

1.3.* Возможен ли кейс, когда при поломке базы происходило моментальное переключение на работающую или починенную базу данных.
- можно создать кластер БД, сотоящий из master ноды, 1 или 2 slave нод  и  настроить репликацию  в режиме реального времени с мастер ноду на slave, чем  повысим отказоустойчивость такой БД(при выходе мастера, slave станет мастеро) и скорость чтения(настоим чтение  из slave  нод)ю    

### Задание 2. PostgreSQL

2.1. С помощью официальной документации приведите пример команды резервирования данных и восстановления БД (pgdump/pgrestore).
```sql
pg_dump -h localhost -U postgres -C -c --if-exists -F directory -f /backup/<backup-postgresql-folder-name> dbname
pg_restore -d dbname -h localhost -U postgres  -j 1 -F directory /backup/<backup-postgresql-folder-name> 
```
2.1.* Возможно ли автоматизировать этот процесс? Если да, то как?
Процесс можно автомизировать:
- создать  скрипт backup_test.sh
```bash
#!/bin/bash
pg_basebackup -h  localhost  -p 5432 -U postgres  -D /backup/dbname."$(date +"%d-%m-%Y-%R")"  -Ft -z -Xs -P >> /home/miroshnichenko/log.txt
find /backup  -type d -mtime +4 -exec rm -rfv {} \; >> /home/miroshnichenko/log1.txt
```
- создать задание в cron
```bash
sudo crontab -u root -e
0 1 * * *      /usr/local/bin/backup_test.sh   > /dev/null 2>&1
```


### Задание 3. MySQL

3.1. С помощью официальной документации приведите пример команды инкрементного резервного копирования базы данных MySQL. 
```sql
mysqldump --flush-logs --delete-master-logs --single-transaction --all-databases | gzip > /var/backups/mysql/$(date +%d-%m-%Y_%H-%M-%S)-inc.gz
sudo mysqldump --flush-logs --delete-source-logs --single-transaction --all-databases | gzip > ~/$(date +%d-%m-%Y_%H-%M-%S)-inc.gz
```
3.1.* В каких случаях использование реплики будет давать преимущество по сравнению с обычным резервным копированием?

Задания, помеченные звёздочкой, — дополнительные, то есть не обязательные к выполнению, и никак не повлияют на получение вами зачёта по этому домашнему заданию. Вы можете их выполнить, если хотите глубже шире разобраться в материале.
